<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Cyberlightning FI-WARE</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    </head>
<style>

.node {
  cursor: pointer;
}

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}



body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

svg {
  font: 10px sans-serif;
}
 
.line {
  fill: none;
  stroke: #000;
  stroke-width: 1.5px;
}
 
.chart rect {
	fill: steelblue;
	stroke: white;
}

</style>
    
    
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
       	<div id="sse">
   			<a href="javascript:WebSocketTest()">Run WebSocket</a>
		</div>
		<div id="myChart"></div>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript" src="tc-min.js"></script>
        <script src="three.min.js"></script>



<script type="text/javascript">
    
	var json;
   
    function displayChart(){
       	
    	var mytc = new Timechart({
        id: "myChart",
        zoom: "d",
        datefield: "event_timestamp",
        datafields: ["event_values[0]", "event_values[1]","event_values[2]"],
        dateformat: "yyyy-mm-dd h:i"
    	},json);
    } 
    
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 500);
    camera.position.set(0, 0, 100);
    camera.lookAt(new THREE.Vector3(0, 0, 0));
    scene = new THREE.Scene();
    
    var material = new THREE.LineBasicMaterial({
        color: 0x0000ff
    });
    
    var geometry = new THREE.Geometry();

    
    function callBack() {
    	
    	var geometry = new THREE.Geometry();
    	geometry.vertices.push(new THREE.Vector3(0, 0, 0));  
    	geometry.vertices.push(new THREE.Vector3(json.event_values[0], json.event_values[1], json.event_values[2]));
    	var line = new THREE.Line(geometry, material);
    	scene.add(line);
    	renderer.render(scene, camera);
  
    }

        function WebSocketTest()
        {
          if ("WebSocket" in window)
          {
             //alert("WebSocket is supported by your Browser!");
             // Let us open a web socket
             //var ws = new WebSocket("ws://127.0.0.1:44445");
             var ws = new WebSocket("ws://dev.cyberlightning.com:44445");
             ws.onopen = function()
             {
                // Web Socket is connected, send data using send()
                ws.send("Message to send");
                alert("Message is sent...");
             };
             ws.onmessage = function (evt)
             {

            	document.getElementById("myChart").innerHTML = evt.data;
                 json = JSON.parse(document.getElementById("myChart").innerHTML);
                 document.getElementById("myChart").innerHTML = "";
                callBack();
             };
             ws.onclose = function()
             {
                // websocket is closed.
                alert("Connection is closed...");
             };
          }
          else
          {
             // The browser doesn't support WebSocket
             alert("WebSocket NOT supported by your Browser!");
          }
        }

  </script>
        
    </body>
</html>
