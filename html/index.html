<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Cyberlightning FI-WARE</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<!--         <link rel="stylesheet" href="css/normalize.css"> -->
<!--         <link rel="stylesheet" href="css/main.css"> -->
<!--         <script src="js/vendor/modernizr-2.6.2.min.js"></script> -->
    </head>
<style>

.node {
  cursor: pointer;
}

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}



body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

svg {
  font: 10px sans-serif;
}
 
.line {
  fill: none;
  stroke: #000;
  stroke-width: 1.5px;
}
 
.chart rect {
	fill: steelblue;
	stroke: white;
}

</style>
    
    
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
       	<div id="sse">
   			<a href="javascript:WebSocketTest()">Run WebSocket</a>
		</div>
		<div id="myChart"></div>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript" src="tc-min.js"></script>



<script type="text/javascript">
    
    var receivedData;
    
    
    function displayChart(){
    	
    	
    	var mytc = new Timechart({
        id: "myChart",
        zoom: "d",
        datefield: "d",
        datafields: ["a", "b"],
        dateformat: "yyyy-mm-dd h:i"
    	},[
        {d:"2013-05-21 00:30",a:767,b:1420},
        {d:"2013-05-21 01:30",a:874.5,b:1467},
        {d:"2013-05-21 02:30",a:808.75,b:1392},
        // ...
        {d:"2013-05-28 21:30",a:1101.5,b:1290},
        {d:"2013-05-28 22:30",a:852,b:1350},
        {d:"2013-05-28 23:30",a:942.75,b:1446}
    	]);
    } 
   
   function displayChart2() {
   	var mytc = new Timechart({
        id: "myChart",
        zoom: "d",
        datefield: "d",
        datafields: ["a", "b"],
        dateformat: "yyyy-mm-dd h:i"
    	},receivedData);
    }
			
			
        function WebSocketTest()
        {
          if ("WebSocket" in window)
          {
             //alert("WebSocket is supported by your Browser!");
             // Let us open a web socket
             var ws = new WebSocket("ws://127.0.0.1:44445");
             ws.onopen = function()
             {
                // Web Socket is connected, send data using send()
                ws.send("Message to send");
                alert("Message is sent...");
             };
             ws.onmessage = function (evt) 
             { 
                var received_msg = evt.data;
          
                alert("Message is received..." + received_msg);
               	
                var jsontext = evt.data;
                receivedData = JSON.parse(jsontext);
				displayChart2();
				
				
				
             };
             ws.onclose = function()
             { 
                // websocket is closed.
                alert("Connection is closed..."); 
             };
          }
          else
          {
             // The browser doesn't support WebSocket
             alert("WebSocket NOT supported by your Browser!");
          }
        }

  </script>
        
    </body>
</html>
