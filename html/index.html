<!doctype html>
<html lang="us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Cyberlightning FI-WARE - IoT project, Author: Tomi Sarni">
    <meta name="viewport" content="width=device-width">
    <title>Cyberlightning FI-WARE</title>

    <link href="css/eggplant/jquery-ui-1.10.3.custom.css" rel="stylesheet">
    
	<script src="js/jquery-1.9.1.js"></script>
	<script src="js/jquery-ui-1.10.3.custom.js"></script>
	<script src="js/three.min.js"></script>
	<script src="js/Chart.js"></script>
		
	<script type="text/javascript">
	 $(function() {
		 $( "#accordion" ).accordion();
		 });
	</script>
	
	<style>
	body{
		font: 62.5% "Trebuchet MS", sans-serif;
		margin: 30px;
		background-color:#1F001F;
	}
	</style>
</head>

<body>
	<div align="left" style="width:100%;height:100px">
		<img alt="" src="assets/logo.png">	
		<button onClick="WebSocketTest()">connect</button>
	</div>
<div style="width:100%;height:100%">
  	
  	
  	<div id="content_left" style="background-color:#D2CCD2;height:500px;width:29%;float:left;">
    	 <canvas id="chart_canvas" height="100%" width="100%"></canvas>
  	</div>
  	
  	<div style="background-color:#938F93;height:500px;width:0.3%;float:left;"></div>
  	
  	<div style="background-color:#D2CCD2;height:500px;width:70.7%;float:left;">
		<div id="accordion" onClick="handleClick">
			
		</div>
  	</div>
  	<div align="right" style="background-color:#4C334C;clear:both;color:white">Copyright Â© 2007 Cyberlightning Ltd.</div>
</div>
	
	<script type="text/javascript">
	
	
	
	var json;
	var sensors = [];
	
	function setContent() {
		
		sensors.push(json);
		
		var alreadyExists = false;
		
		for(var i =0;i<sensors.length;i++){
			if(sensors[i].properties.type.equals(json.properties.type)) {
				alreadyExists = true;
			}
		}
		
		if (!alreadyExists) {
			var active = $('#accordion').accordion('option', 'active');
			$('#accordion').append('<h3><a href="#drawCharts('+json.properties.type+')">'+json.properties.type +'</a></h3><div><p>'+ json +'</p></div>')
			    .accordion('destroy').accordion({ active: active});
		}
		
		
	}

	
	function drawCharts(type) {
		
		var xValues = [];
		var yValues = [];
		var zValues = [];
		var timeStamps = [];
		
		for (var i = 0 ; i < sensors.length; i++) {
			if (sensors[i].properties.type.equals(type)) {
				xValues.push(sensors[i].event_values[0]);
				yValues.push(sensors[i].event_values[1]);
				zValues.push(sensors[i].event_values[2]);
				timeStamps.push(sensors[i].event_timestamp)	
			}
		}
		
		if(type.equals(TYPE_LIGHT)) {
			
			var barChartData = {
					labels : timeStamps,
					datasets : [
						{
							fillColor : "rgba(220,220,220,0.5)",
							strokeColor : "rgba(220,220,220,1)",
							data : xValues
						}
					]
				}
			
			var myLine = new Chart(document.getElementById("chart_canvas").getContext("2d")).Bar(barChartData);
		} 
	}
	
	function WebSocketTest()
     {
       if ("WebSocket" in window)
       {
          //alert("WebSocket is supported by your Browser!");
          // Let us open a web socket
          //var ws = new WebSocket("ws://127.0.0.1:44445");
          var ws = new WebSocket("ws://dev.cyberlightning.com:44445");
          ws.onopen = function()
          {
             // Web Socket is connected, send data using send()
             ws.send("Message to send");
             alert("Message is sent...");
          };
          ws.onmessage = function (evt)
          {
        	document.getElementById("chart_canvas").innerHTML = evt.data;
            json = JSON.parse(document.getElementById("chart_canvas").innerHTML);
            setContent();

          };
          ws.onclose = function()
          {
             // websocket is closed.
             alert("Connection is closed...");
          };
       }
       else
       {
          // The browser doesn't support WebSocket
          alert("WebSocket NOT supported by your Browser!");
       }
     }
	 
	 
	</script>
</body>
</html>
