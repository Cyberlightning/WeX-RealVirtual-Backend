<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Cyberlightning FI-WARE</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<!--         <link rel="stylesheet" href="css/normalize.css"> -->
<!--         <link rel="stylesheet" href="css/main.css"> -->
<!--         <script src="js/vendor/modernizr-2.6.2.min.js"></script> -->
    </head>
<style>

.node {
  cursor: pointer;
}

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}



body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

svg {
  font: 10px sans-serif;
}
 
.line {
  fill: none;
  stroke: #000;
  stroke-width: 1.5px;
}
 
.chart rect {
	fill: steelblue;
	stroke: white;
}

</style>
    
    
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
       	<div id="sse">
   			<a href="javascript:WebSocketTest()">Run WebSocket</a>
 
		</div>
		
		<div id="test-chart"></div>

        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript">
    		
  function onCallBack(data) {
      var rect = svg.selectAll(".bar rect").data(data);
      var text = svg.selectAll(".bar text").data(data);
      var delay = function(d, i) { return i * 50; };
      rect.transition().duration(750)
        .delay(delay)
        .attr("width", function(d) { return x(d.value); });
      text.transition().duration(750)
        .delay(delay)
        .attr("x", function(d) { return x(d.value); })
        .text(function(d) { return d.value; });
  }
    		
			
var data = [{"number":1, "value":8},{"number":2, "value":16},{"number":3, "value":32},{"number":4, "value":64}];
var w = 515;
var h = 660;
var x = d3.scale.linear()
  .domain([0, d3.max(data, function(d) { return d.value; })])
  .range([0, w]);
var y = d3.scale.ordinal()
  .domain(d3.range(data.length))
  .rangeBands([0, h], 0.1);
var color = d3.scale.ordinal()
  .range(["red", "blue"]);

//initial svg creation
var svg = d3.select("#test-chart")
  .append("svg")
    .attr("width", 815 + 40)
    .attr("height", h + 20)
  .append("g")
    .attr("transform", "translate(20,0)");

//bars
var bars = svg.selectAll(".bar")
    .data(data)
  .enter().append("g")
    .attr("class", "bar")
    .attr("transform", function(d, i) { return "translate(" + 0 + "," + y(i+1) + ")"; });
//bar rectangles
bars.append("rect")
  .attr("fill", function(d, i) { return color(i%2); })
  .attr("width", function(d) { return x(d.value); })
  .attr("height", y.rangeBand());
//bar labels
bars.append("text")
  .attr("x", function(d) { return x(d.value); })
  .attr("y", 0 + y.rangeBand() / 2)
  .attr("dx", -6)
  .attr("dy", ".35em")
  .attr("text-anchor", "end")
  .text(function(d) { return d.value; });

		
			
			
			
        function WebSocketTest()
        {
          if ("WebSocket" in window)
          {
             //alert("WebSocket is supported by your Browser!");
             // Let us open a web socket
             var ws = new WebSocket("ws://127.0.0.1:44445/");
             ws.onopen = function()
             {
                // Web Socket is connected, send data using send()
                ws.send("Message to send");
                alert("Message is sent...");
             };
             ws.onmessage = function (evt) 
             { 
                var received_msg = evt.data;
                alert("Message is received..." + received_msg);
               	
                var jsontext = evt.data;
                jsonData = JSON.parse(jsontext);
				onCallBack(jsonData)
				//document.getElementById("asd").innerHTML = contact.points[0];
				
				
             };
             ws.onclose = function()
             { 
                // websocket is closed.
                alert("Connection is closed..."); 
             };
          }
          else
          {
             // The browser doesn't support WebSocket
             alert("WebSocket NOT supported by your Browser!");
          }
        }

  </script>
        
    </body>
</html>
